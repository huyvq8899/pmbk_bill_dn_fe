<nz-spin [nzSpinning]="loading">
    <div nz-row class="sameHeightChildren" style="margin-left: 8px; margin-right: 8px; margin-top: 20px;">
        <div nz-col nzXs="24" nzSm="9" nzMd="9" nzLg="9" nzXl="9" class="box-border">
            <span class="box-title" style="font-weight: bold; font-size: 18px">Danh sách vai trò</span>
            <form nz-form [formGroup]="nhomTaiKhoanForm">
                <!-- <nz-form-item>
          <input nzSize="small" nz-input formControlName="tenNhomTaiKhoan" id="tenNhomTaiKhoan"
            placeholder="Nhập tên vai trò kế toán" style="height: 30px!important; width: 80%"
            (ngModelChange)="changeTenNhomTaiKhoan($event)" />

          <button nz-button nzType="default" type="button" nzSize="small" (click)="deleteNhomTaiKhoan()"
            title="Xóa nhóm vai trò kế toán đã chọn" style="float: right;height: 30px!important;width: 30px!important;"
            [disabled]="selectedRoleId === 'new' || selectedRoleId === '' || selectedRoleId === 'none' ">
            <i nz-icon nzType="delete" nzTheme="outline"></i></button>
          <button nz-button nzType="default" type="button" nzSize="small" (click)="addNhomTaiKhoan()" title="Thêm mới"
            style="float: right;height: 30px!important;width: 30px!important;margin-right: 8px!important;">
            <i nz-icon nzType="plus" nzTheme="outline"></i></button>
        </nz-form-item> -->

                <nz-form-item>
                    <div nz-row style="margin-bottom: 2px;">
                        <div nz-col nzSpan="8" style="text-align: left;">
                            <nz-button-group nzSize="small">
                                <button nzSize="small" nz-button nzType="default" nz-tooltip (click)="clickThem()" nzTooltipTitle="Thêm">
                  <i nz-icon nzType="plus" nzTheme="outline"></i>Thêm
                </button>
                            </nz-button-group>
                        </div>
                    </div>
                    <nz-table [nzNoResult]="null" nzSize="small" nzBordered #nhomTaiKhoanTable nzShowPagination="false" [(nzPageSize)]="pageSize" [nzData]="listRole" [nzScroll]="{x: '100%', y: '450px'}">
                        <thead>
                            <th nzAlign="center" nzWidth="20%">STT</th>
                            <th nzAlign="center" nzWidth="60%">
                                Tên vai trò</th>
                            <th nzAlign="center" nzWidth="20%">Thao tác
                            </th>
                        </thead>

                        <tbody>
                            <tr *ngFor="let data of nhomTaiKhoanTable.data; let i = index" (click)="selectedRow(data)">
                                <td nzAlign="center" [class.row-selected]="data.selected">
                                    {{i + 1}}
                                </td>
                                <td [class.row-selected]="data.selected">
                                    {{data.roleName}}
                                </td>
                                <td [class.row-selected]="data.selected">
                                    <nz-button-group nzSize="small">
                                        <button nzSize="small" nz-button nzType="default" nz-tooltip (click)="clickSua(data)" nzTooltipTitle="Sửa">
                      <i nz-icon nzType="edit" nzTheme="outline"></i>
                    </button>
                                        <button (click)="clickXoa(data)" nz-button nz-tooltip nzTooltipTitle="Xóa"><i nz-icon
                        nzType="delete"></i></button>
                                    </nz-button-group>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </nz-form-item>
            </form>
        </div>

        <div nz-col nzXs="24" nzSm="15" nzMd="15" nzLg="15" nzXl="15" class="box-border unset-border-left noneCollapsedTree">
            <span class="box-title" style="font-weight: bold; font-size: 18px">Vai trò kế toán {{nhomTaiKhoanDaChon}} sử dụng
        các chức năng</span>
            <nz-table [nzNoResult]="null" nzSize="small" nzBordered #dsChucNangTable nzShowPagination="false" [(nzPageSize)]="pageSize" [nzData]="listFunction" [nzLoading]="loadingDSChucNang" [nzScroll]="{x: '300px', y: '450px'}">
                <thead>
                    <th nzAlign="center" style="border: #BBBBBB solid 1px; padding-top: 5px; padding-bottom: 5px; font-weight: normal">Tên phân hệ/chức năng</th>
                    <th nzAlign="center" nzWidth="150px" style="border-top: #BBBBBB solid 1px;border-bottom: #BBBBBB solid 1px; padding-top: 5px; padding-bottom: 5px;font-weight: normal">
                        Được sử dụng <label nz-checkbox (ngModelChange)="changeCheckAll($event)" [(ngModel)]="checkAll" [(nzIndeterminate)]="checkIndeterminate"></label></th>
                </thead>

                <tbody>
                    <ng-container *ngFor="let data of dsChucNangTable.data">
                        <ng-container *ngFor="let item of mapOfExpandedData[data.key]">
                            <tr *ngIf="(item.parent && item.parent.expand) || !item.parent" [class.bold-text]="item.children != null">
                                <td [nzIndentSize]="item.level * 20" [nzShowExpand]="!!item.children" [(nzExpand)]="item.expand" (nzExpandChange)="collapse(mapOfExpandedData[data.key], item, $event)">
                                    {{item?.title }}
                                </td>
                                <td nzAlign="center">
                                    <label nz-checkbox (ngModelChange)="changeSuDung($event, item, mapOfExpandedData[data.key])" [(ngModel)]="item.suDung" [(nzIndeterminate)]="item.indeterminate"></label>
                                </td>
                            </tr>
                        </ng-container>
                    </ng-container>
                </tbody>
            </nz-table>
        </div>
    </div>
</nz-spin>