<div class="card-title" style="padding-right: 40px;background-color: #dedede;margin-top: -36px;">

    <div class="hdsd">
        <div nz-row class="box-content-hd">
            <div nz-col class="col-left" [nzSpan]="12"></div>
            <div nz-col class="col-right" [nzSpan]="12" >
                <span class="xemhd" (click)="xemHuongDanChiTiet('D9D40958-A613-29B0-53D2-B9FB0FADE5D0')">Hướng dẫn chi tiết</span>
                <span id="videohdcts" class="filterDefaultButton xemvideo" (click)="xemHuongDanChiTiet('D9D40958-A613-29B0-53D2-B9FB0FADE5D0','Tạo ký hiệu hóa đơn',2)"><span class="material-icons-outlined">
                                  play_circle_filled
                                  </span> Xem video</span>
            </div>

        </div>
    </div>
</div>
<nz-spin [nzSpinning]="spinning">
    <div nz-row nzGutter="4" class="inner-content">
        <form nz-form [formGroup]="mainForm" class="form">
            <div nz-col nzSpan="16">
                <div nz-row>
                    <span class="boldText">Tờ khai đăng ký/thay đổi thông tin sử dụng dịch vụ hóa đơn điện tử</span>

                    <nz-table class="table-hover" [nzNoResult]="null" nzSize="small" #tableB [nzData]="listToKhai"
                        [nzWidthConfig]="widthConfigB" [nzScroll]="scrollConfigB" [nzFrontPagination]="false"
                        [nzTotal]="listToKhai.length" [nzPageIndex]="1" [nzPageSize]="listToKhai.length" nzBordered
                        [nzHideOnSinglePage]="true">
                        <thead>
                            <tr>
                                <th nzAlign="center">Mã thông điệp gửi</th>
                                <th nzAlign="center">Thời gian gửi</th>
                                <th nzAlign="center">Mã thông điệp nhận</th>
                            </tr>
                        </thead>
                        <tbody>
                            <ng-container *ngIf="tableB.data.length > 0; else emptyToKhais">
                                <tr *ngFor="let data of tableB.data">
                                    <td>
                                        <a (click)="xemToKhai(data)">{{data.maThongDiepGui}}</a>
                                    </td>
                                    <td nzAlign="center">
                                        {{data.thoiGianGui | date:'dd/MM/yyyy HH:mm:ss'}}
                                    </td>
                                    <td>
                                        <a (click)="xemThongDiepNhan(data)">
                                            {{data.maThongDiepNhan}}
                                        </a>
                                    </td>
                                </tr>
                            </ng-container>
                            <ng-template #emptyToKhais>
                            </ng-template>
                        </tbody>
                    </nz-table>
                </div>
                <div nz-row nzGutter="8" style="margin-top: 10px;">
                    <div nz-col nzSpan="14">
                        <nz-card class="card-custom">
                            <div class="card-title">
                                Ký hiệu
                            </div>
                            <div class="card-body card-content-padding-hor">
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="7">Hình thức hóa đơn</nz-form-label>
                                    <nz-form-control [nzSpan]="17" (click)="CheckCanhBaoDaPhatSinh(1);">
                                        <nz-select style="width: 100%;" [nzSize]="'small'" nzShowSearch
                                            formControlName="hinhThucHoaDon"
                                            nzAutoFocus = "false"
                                            [nzOpen] = "IsCanhBaoDaPhatSinhActive"
                                            (ngModelChange)="changeHinhThucHoaDon($event)">
                                            <nz-option [nzHide]="!IsCanhBaoDaPhatSinhActive && IsBoKyHieuDaTaoHoaDonNhap"  *ngFor="let item of hinhThucHoaDons" [nzLabel]="item.value"
                                                [nzValue]="item.key">
                                            </nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item>
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="7">Loại hóa đơn</nz-form-label>
                                    <nz-form-control [nzSpan]="17" (click)="CheckCanhBaoDaPhatSinh(2);">
                                        <nz-select id="SelectLoaiHoaDon" style="width: 100%;" [nzSize]="'small'" nzShowSearch
                                            formControlName="loaiHoaDon" (ngModelChange)="changeLoaiHoaDon($event)" 
                                            nzAutoFocus = "false"
                                            [nzOpen] = "IsCanhBaoDaPhatSinhActiveL"
                                            nzDropdownClassName="no-whitepsace-dropdown"   (nzBlur)="CloseCanhBao()">
                                            <nz-option [nzHide]="!IsCanhBaoDaPhatSinhActiveL && IsBoKyHieuDaTaoHoaDonNhap"  *ngFor="let item of loaiHoaDons" [nzLabel]="item.value"
                                                [nzValue]="item.key">
                                            </nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item>
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="7">Ký hiệu</nz-form-label>
                                    <div class="ky-hieu-control-wrapper">
                                        <div>
                                            <input nz-input nzSize="small" formControlName="kyHieuMauSoHoaDon" />
                                        </div>
                                        <div>
                                            <input nz-input nzSize="small" formControlName="kyHieu1" />
                                        </div>
                                        <div>
                                            <nz-select  style="width: 100%;" [nzSize]="'small'" nzShowSearch
                                                formControlName="kyHieu23" (ngModelChange)="setKyHieuHoaDon()" nzDisabled>
                                                <nz-option *ngFor="let item of kyHieu23s" [nzLabel]="item"
                                                    [nzValue]="item">
                                                </nz-option>
                                            </nz-select>
                                        </div>
                                        <div>
                                            <nz-select nzSize="small" nzShowSearch formControlName="kyHieu4"
                                                nzServerSearch (nzOnSearch)="searchKyHieu4($event)"
                                                (ngModelChange)="setKyHieuHoaDon()"
                                                [nzDropdownStyle]="customOverlayStyle1">
                                                <nz-option nzCustomContent nzDisabled="true">
                                                    <div nz-row>
                                                        <div nz-col nzXs="3" nzSm="3" nzMd="3" nzLg="3" nzXl="3">
                                                            Chữ cái
                                                        </div>
                                                        <div nz-col nzXs="21" nzSm="21" nzMd="21" nzLg="21" nzXl="21">
                                                            Thể hiện loại hóa đơn được sử dụng
                                                        </div>
                                                    </div>
                                                </nz-option>
                                                <nz-option nzCustomContent *ngFor="let item of kyHieuThu4sSearch"
                                                    [nzLabel]="item.key" [nzValue]="item.key">
                                                    <div nz-row>
                                                        <div title="{{item?.key}}" nz-col nzXs="3" nzSm="3" nzMd="3"
                                                            nzLg="3" nzXl="3">
                                                            <div class="text-ellipsis">{{item?.key}}</div>
                                                        </div>
                                                        <div title="{{item?.value}}" nz-col nzXs="21" nzSm="21"
                                                            nzMd="21" nzLg="21" nzXl="21">
                                                            <div class="justify-content-wrap">{{item?.value}}</div>
                                                        </div>
                                                    </div>
                                                </nz-option>
                                            </nz-select>
                                        </div>
                                        <div>
                                            <nz-select style="width: 100%;" [nzSize]="'small'" nzShowSearch
                                                formControlName="kyHieu56" (ngModelChange)="setKyHieuHoaDon()">
                                                <nz-option *ngFor="let item of kyHieu56s" [nzLabel]="item"
                                                    [nzValue]="item">
                                                </nz-option>
                                            </nz-select>
                                        </div>
                                    </div>
                                </nz-form-item>
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="8" style="visibility: hidden;">.</nz-form-label>
                                </nz-form-item>
                            </div>
                        </nz-card>
                    </div>
                    <div nz-col nzSpan="10">
                        <nz-card class="card-custom">
                            <div class="card-title">
                                Số hóa đơn
                            </div>
                            <div class="card-body card-content-padding-hor">
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="16">Số bắt đầu từ</nz-form-label>
                                    <nz-form-control [nzSpan]="8" [nzErrorTip]="errorSoBatDau"
                                        class="tooltip-width-220 tooltip-left-0">
                                        <input nz-input bkCurrencyMask nzSize="small" [options]="{ maxIntegerDigit: 8 }"
                                            formControlName="soBatDau" tooltipInput />
                                        <ng-template #errorSoBatDau let-control>
                                            <ng-container *ngIf="control.hasError('required')">
                                                <div class="tooltip-error">Không được để trống.</div>
                                            </ng-container>
                                            <ng-container *ngIf="control.hasError('min') || control.hasError('max')">
                                                <div class="tooltip-error">Không được lớn hơn số 99.999.999.</div>
                                            </ng-container>
                                        </ng-template>
                                    </nz-form-control>
                                </nz-form-item>
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="16">Số lớn nhất đã lập đến hiện tại
                                    </nz-form-label>
                                    <nz-form-control [nzSpan]="8">
                                        <input nz-input class="input-currency"
                                            [value]="mainForm.getRawValue().soLonNhatDaLapDenHienTai | formatPrice"
                                            nzSize="small" formControlName="soLonNhatDaLapDenHienTai" />
                                    </nz-form-control>
                                </nz-form-item>
                                <nz-form-item>
                                    <nz-form-label [nzSpan]="16" nzFor="soToiDa">Số tối đa đến</nz-form-label>
                                    <nz-form-control [nzSpan]="8" [nzErrorTip]="errorSoToiDa"
                                        class="tooltip-width-220 tooltip-left-0">
                                        <input nz-input bkCurrencyMask [options]="{ maxIntegerDigit: 8 }" nzSize="small"
                                            formControlName="soToiDa" tooltipInput />
                                        <ng-template #errorSoToiDa let-control>
                                            <ng-container *ngIf="control.hasError('required')">
                                                <div class="tooltip-error">Không được để trống.</div>
                                            </ng-container>
                                            <ng-container *ngIf="control.hasError('min') || control.hasError('max')">
                                                <div class="tooltip-error">Không được lớn hơn số 99.999.999.</div>
                                            </ng-container>
                                            <ng-container *ngIf="control.hasError('invalid')">
                                                <div class="tooltip-error">Không được nhỏ hơn số bắt đầu</div>
                                            </ng-container>
                                        </ng-template>
                                    </nz-form-control>
                                </nz-form-item>
                                <nz-form-item>
                                    <nz-form-control>
                                        <label nz-checkbox
                                            [nzDisabled]="mainForm.getRawValue().soLonNhatDaLapDenHienTai"
                                            formControlName="isTuyChinh" (ngModelChange)="tuyChinhNguyenTacSHD($event)">
                                            Tùy chỉnh nguyên tắc số hóa đơn
                                        </label>
                                    </nz-form-control>
                                </nz-form-item>
                            </div>
                        </nz-card>
                    </div>
                </div>
                <div nz-row style="margin-top: 10px;">
                    <ng-container *ngIf="mainForm.getRawValue().hinhThucHoaDon === 0">
                        <nz-card class="card-custom" style="width: 100%">
                            <div class="card-title">
                                Phương thức chuyển dữ liệu
                            </div>
                            <div class="card-body card-content-padding-hor">
                                <nz-form-item>
                                    <nz-form-control>
                                        <nz-radio-group formControlName="phuongThucChuyenDL" (ngModelChange)="changePTChuyenDL($event)"
                                            [nzDisabled]="mainForm.get('phuongThucChuyenDL').disabled"
                                            [ngClass]="{'notOpacityRadio': 1 == 1}" style="width: 100%;">
                                            <ng-container *ngIf="isChuyenDayDuNoiDungTungHoaDon">
                                                <label nz-radio [nzValue]="0">
                                                    Chuyển đầy đủ nội dung từng hóa đơn
                                                </label>
                                                <div
                                                    style="text-align: justify !important; background-color: #FFF2CC; margin: 5px 0; padding: 5px;">
                                                    Ngay sau khi hóa đơn được người bán gửi cho người mua, hệ thống sẽ
                                                    tự
                                                    động
                                                    gửi hóa đơn cho cơ quan thuế. Nếu chưa gửi ngay hóa đơn cho khách
                                                    hàng, chương trình sẽ tự động gửi dữ liệu hóa đơn đến cơ quan thuế
                                                    vào cuối ngày.
                                                </div>
                                            </ng-container>
                                            <ng-container *ngIf="isChuyenBangTongHop">
                                                <label nz-radio [nzValue]="1">
                                                    Chuyển theo bảng tổng hợp dữ liệu hóa đơn điện tử
                                                </label>
                                                <div
                                                    style="text-align: justify !important; background-color: #FFF2CC; margin: 5px 0; padding: 5px;">
                                                    Người bán lập Bảng tổng hợp dữ liệu hóa đơn điện tử hàng hóa, cung
                                                    cấp
                                                    dịch
                                                    vụ phát sinh trong tháng hoặc quý (tính từ ngày đầu của tháng, quý
                                                    đến
                                                    ngày
                                                    cuối cùng của tháng hoặc quý) để gửi cơ quan thuế cùng với thời gian
                                                    gửi
                                                    Tờ
                                                    khai thuế giá trị gia tăng theo kỳ kê khai thuế GTGT mà người nộp
                                                    thuế
                                                    đang
                                                    áp dụng (theo tháng hoặc quý).
                                                </div>
                                            </ng-container>
                                        </nz-radio-group>
                                    </nz-form-control>
                                    <div>
                                        Tờ khai đăng ký/thay đổi thông tin sử dụng dịch vụ hóa đơn điện tử:
                                        <a (click)="xemToKhai(toKhaiMoiNhat)">{{toKhaiMoiNhat?.maThongDiepGui}}</a>
                                    </div>
                                </nz-form-item>
                            </div>
                        </nz-card>
                    </ng-container>
                </div>
                <div nz-row style="margin-top: 10px;">
                    <div nz-col nzSpan="12" style="padding-top: 10px;">
                        <span class="boldText">Mẫu hóa đơn</span>
                    </div>
                    <div nz-col nzSpan="12" style="text-align: right; margin-bottom: 5px;">
                        <button *ngIf="!btnLayDuLieuHide" nzSize="small" nz-button nzType="default"
                            (click)="getMauHoaDons()" class="button-clear" [nzLoading]="spinning"
                            [disabled]="btnLayDuLieuDisabled" [class.button-clear]="!btnLayDuLieuDisabled"
                            [class.ant-btn-cus]="btnLayDuLieuDisabled"
                            [ngClass]="{'disabled-button-state': btnLayDuLieuDisabled}">
                            <i nz-icon nzType="sync" nzTheme="outline"></i>&nbsp;Lấy dữ liệu
                        </button>
                    </div>
                    <div nz-col nzSpan="24">
                        <nz-table class="table-hover" [nzNoResult]="null" nzSize="small" #tableA
                            [nzData]="listMauHoaDon" [nzWidthConfig]="widthConfigA" [nzScroll]="scrollConfigA"
                            [nzFrontPagination]="false" [nzTotal]="listMauHoaDon.length" [nzPageIndex]="1"
                            [nzPageSize]="listMauHoaDon.length" nzBordered [nzHideOnSinglePage]="true">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th nzAlign="center">Tên mẫu hóa đơn</th>
                                    <th nzAlign="center" *ngIf="mainForm.getRawValue().loaiHoaDon != 7 && mainForm.getRawValue().loaiHoaDon != 2 && mainForm.getRawValue().loaiHoaDon != 8 && mainForm.getRawValue().loaiHoaDon != 10 ">Thuế GTGT</th>
                                    <th nzAlign="center">Trạng thái</th>
                                    <th nzAlign="center">Xem mẫu hóa đơn</th>
                                </tr>
                            </thead>
                            <tbody>
                                <ng-container *ngFor="let data of tableA.data">
                                    <tr [class.row-selected]="data.checked">
                                        <td [nzDisabled]="btnLuuDisabled" [class.row-selected]="data.checked"
                                            nzShowCheckbox [(nzChecked)]="data.checked"
                                            (nzCheckedChange)="checkedMauHoaDon(data)"></td>
                                        <td [class.row-selected]="data.checked">{{data.ten}}</td>
                                        <td [class.row-selected]="data.checked" *ngIf="mainForm.getRawValue().loaiHoaDon != 7 && mainForm.getRawValue().loaiHoaDon != 2  && mainForm.getRawValue().loaiHoaDon != 8 && mainForm.getRawValue().loaiHoaDon != 10">
                                            <span class="status" [ngClass]="{
                                                'status-orange': data.loaiThueGTGT === 1,
                                                'status-green': data.loaiThueGTGT === 2
                                              }">
                                                {{data.loaiThueGTGT === 1 ? 'Một thuế suất' : 'Nhiều thuế suất'}}
                                              </span>
                                        </td>
                                        <td [class.row-selected]="data.checked">
                                            <app-tag-status-ky-dien-tu [isDaKy]="!!data.ngayKy">
                                            </app-tag-status-ky-dien-tu>
                                        </td>
                                        <td nzAlign="center" [class.row-selected]="data.checked">
                                            <a (click)="xemMauHoaDon(data)">Xem</a>
                                        </td>
                                    </tr>
                                </ng-container>
                                <tr class="total-footer" *ngIf="tableA.data.length <= 0">
                                    <td colspan="5"> Không có dữ liệu hiển thị.
                                    </td>
                                </tr>
                            </tbody>
                        </nz-table>
                        <div  *ngIf="mainForm.getRawValue().loaiHoaDon == 1 || mainForm.getRawValue().loaiHoaDon == 9" style="text-align: justify !important; background-color: #FFF2CC; padding: 5px;">
                            Người dùng được chọn 2 mẫu hóa đơn ứng với 2 lựa chọn thuế GTGT là <b>Một thuế suất</b> và <b>Nhiều thuế suất</b>. Mỗi lựa chọn thuế suất chỉ được chọn 1 mẫu hóa đơn.
                        </div>
                    </div>
                </div>
            </div>
            <div nz-col nzSpan="8">
                <nz-card class="card-custom">
                    <div class="card-title">
                        Nhật ký xác thực
                    </div>
                    <div class="card-body">
                        <nz-form-item>
                            <nz-form-label [nzSpan]="4" nzFor="kyHieu">Ký hiệu</nz-form-label>
                            <nz-form-control [nzSpan]="5">
                                <input nz-input nzSize="small" formControlName="kyHieu" />
                            </nz-form-control>
                            <nz-form-label [nzSpan]="7" nzFor="tenTrangThaiSuDung">Trạng thái sử dụng</nz-form-label>
                            <nz-form-control [nzSpan]="8"
                                style="text-align: right; margin-right: 0px; margin-left: -15px;">
                                <app-tag-status-su-dung [loai]="mainForm.getRawValue().trangThaiSuDung">
                                </app-tag-status-su-dung>
                            </nz-form-control>
                        </nz-form-item>
                        <div nz-row style="flex: 1;">
                            <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24" class="box-nhat-ky-xac-thuc">
                                <div class="content-nhat-ky-xac-thuc">
                                    <nz-timeline>
                                        <ng-container *ngFor="let item of nhatKys; let i=index">
                                            <nz-timeline-item *ngIf="item.trangThaiSuDung === 0" nzColor="orange">
                                                <div class="status-nhat-ky status-chua-xac-thuc">
                                                    {{item.tenTrangThaiSuDung}}</div>
                                            </nz-timeline-item>
                                            <nz-timeline-item *ngIf="item.trangThaiSuDung === 1">
                                                <div class="status-nhat-ky status-da-xac-thuc">
                                                    {{item.tenTrangThaiSuDung}}
                                                </div>
                                                <ng-container
                                                    *ngIf="!!item.tenNguoiXacThuc; else isDaXacThucHeThongTemplate">
                                                    <div>
                                                        - <b>{{item.tenNguoiXacThuc}}</b> đã xác thực:
                                                        {{item.thoiGianXacThuc | date:'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                    <div>
                                                        - Tên tổ chức chứng thực chữ ký số, chứ ký điện tử:
                                                        {{item.tenToChucChungThuc}}
                                                    </div>
                                                    <div>
                                                        - Số sê-ri chứng thư: {{item.soSeriChungThu}}
                                                    </div>
                                                    <div>
                                                        - Thời hạn sử dụng chứng thư số: từ ngày {{item.thoiGianSuDungTu
                                                        | date:'dd/MM/yyyy HH:mm:ss'}} đến ngày {{item.thoiGianSuDungDen
                                                        | date:'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                    <div>
                                                        - Phương thức chuyển dữ liệu: {{item.tenPhuongThucChuyenDL}}
                                                    </div>
                                                    <div>
                                                        - Mẫu hóa đơn: 
                                                        <ng-container *ngIf="expression; else elseTemplate">
                                                            
                                                        </ng-container>
                                                        <ng-template #elseTemplate>
                                                            
                                                        </ng-template>
                                                        
                                                        <ng-container *ngIf="item.mauHoaDons.length > 0; else MauHoaDon0">
                                                            <ng-container *ngFor="let mauHoaDon of item.mauHoaDons, let i = index">
                                                                <b>{{mauHoaDon.ten}}</b>&nbsp;
                                                                <a (click)="xemMauHoaDonTaiDay(mauHoaDon)"><i>(Xem tại đây)</i></a>
                                                                <span *ngIf="item.mauHoaDons != (i + 1)">; </span>
                                                            </ng-container>
                                                        </ng-container>
                                                        <ng-template #MauHoaDon0>
                                                            <b>{{item.tenMauHoaDon}}</b>&nbsp;
                                                            <a (click)="xemMauHoaDonTaiDay(item)"><i>(Xem tại đây)</i></a>
                                                        </ng-template>
                                                    </div>
                                                    <div>
                                                        - Mã thông điệp gửi CQT: <a
                                                            (click)="xemToKhai(item)">{{item.maThongDiepGui}}</a>
                                                    </div>
                                                    <div>
                                                        - Thời điểm chấp nhận: {{item.thoiDiemChapNhan |
                                                        date:'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                </ng-container>
                                                <ng-template #isDaXacThucHeThongTemplate>
                                                    <div>
                                                        - <b>Hệ thống</b> tự động xác thực: {{item.thoiGianXacThuc |
                                                        date:'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                    <div>
                                                        - Phương thức chuyển dữ liệu: {{item.tenPhuongThucChuyenDL}}
                                                    </div>
                                                    <div>
                                                        - Mẫu hóa đơn: 
                                                        <ng-container *ngIf="item.mauHoaDons.length > 0; else MauHoaDon0">
                                                            <ng-container *ngFor="let mauHoaDon of item.mauHoaDons, let i = index">
                                                                <b>{{mauHoaDon.ten}}</b>&nbsp;
                                                                <a (click)="xemMauHoaDonTaiDay(mauHoaDon)"><i>(Xem tại đây)</i></a>
                                                                <span *ngIf="item.mauHoaDons != (i + 1)">; </span>
                                                            </ng-container>
                                                        </ng-container>
                                                        <ng-template #MauHoaDon0>
                                                            <b>{{item.tenMauHoaDon}}</b>&nbsp;
                                                            <a (click)="xemMauHoaDonTaiDay(item)"><i>(Xem tại đây)</i></a>
                                                        </ng-template>
                                                    </div>
                                                    <div>
                                                        - Mã thông điệp gửi CQT: <a
                                                            (click)="xemToKhai(item)">{{item.maThongDiepGui}}</a>
                                                    </div>
                                                    <div>
                                                        - Thời điểm chấp nhận: {{item.thoiDiemChapNhan |
                                                        date:'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                </ng-template>
                                            </nz-timeline-item>
                                            <nz-timeline-item *ngIf="item.trangThaiSuDung === 3" nzColor="red">
                                                <div class="status-nhat-ky status" style="color: red;">
                                                    {{item.tenTrangThaiSuDung}}</div>
                                                <ng-container
                                                    *ngIf="!!item.tenNguoiXacThuc && item.loaiHetHieuLuc != 3; else isNgungSuDungTuHeThongTemplate">
                                                    <div>
                                                        - <b>{{item.tenNguoiXacThuc}}</b> đã xác thực:
                                                        {{item.thoiGianXacThuc | date:'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                    <div>
                                                        - Tên tổ chức chứng thực chữ ký số, chứ ký điện tử:
                                                        {{item.tenToChucChungThuc}}
                                                    </div>
                                                    <div>
                                                        - Số sê-ri chứng thư: {{item.soSeriChungThu}}
                                                    </div>
                                                    <div>
                                                        - Thời hạn sử dụng chứng thư số: từ ngày {{item.thoiGianSuDungTu
                                                        | date:'dd/MM/yyyy HH:mm:ss'}} đến ngày {{item.thoiGianSuDungDen
                                                        | date:'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                </ng-container>
                                                <ng-template #isNgungSuDungTuHeThongTemplate>
                                                    <div>
                                                        - <b>Hệ thống</b> tự động xác thực: {{item.thoiGianXacThuc |
                                                        date:'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                    <div *ngIf="item.loaiHetHieuLuc != 3">
                                                        - Ngừng sử dụng do người nộp thuế ngừng sử dụng
                                                        <b>{{item.noiDung}}</b> có liên quan tại tờ khai đăng ký/thay
                                                        đổi thông tin sử dụng dịch vụ hóa đơn điện tử có mã thông điệp
                                                        gửi <a (click)="xemToKhai(item)">{{item.maThongDiepGui}}</a> đã
                                                        được cơ
                                                        quan thuế chấp nhận ngày {{item.thoiDiemChapNhan |
                                                        date:'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                    <div *ngIf="item.loaiHetHieuLuc == 3">
                                                        - Ngừng sử dụng theo thông báo về việc hết thời gian sử dụng hóa
                                                        đơn điện tử có mã qua cổng thông tin điện tử Tổng cục Thuế/qua
                                                        ủy thác tổ chức cung cấp dịch vụ về hóa đơn điện tử; không thuộc
                                                        trường hợp sử dụng hóa đơn điện tử không có mã. Được cơ quan
                                                        thuế gửi đến người nộp thuế ngày {{item.createdDate | date:
                                                        'dd/MM/yyyy HH:mm:ss'}}
                                                    </div>
                                                    <div>
                                                        - Hệ thống không cho phép <b>Xác thực sử dụng</b> trong trường
                                                        hợp tự động ngừng sử dụng này
                                                    </div>
                                                </ng-template>
                                                <div>
                                                    - Phương thức chuyển dữ liệu: {{item.tenPhuongThucChuyenDL}}
                                                </div>
                                                <div>
                                                    - Mẫu hóa đơn: 
                                                    <ng-container *ngIf="item.mauHoaDons.length > 0; else MauHoaDon0">
                                                        <ng-container *ngFor="let mauHoaDon of item.mauHoaDons, let i = index">
                                                            <b>{{mauHoaDon.ten}}</b>&nbsp;
                                                            <a (click)="xemMauHoaDonTaiDay(mauHoaDon)"><i>(Xem tại đây)</i></a>
                                                            <span *ngIf="item.mauHoaDons != (i + 1)">; </span>
                                                        </ng-container>
                                                    </ng-container>
                                                    <ng-template #MauHoaDon0>
                                                        <b>{{item.tenMauHoaDon}}</b>&nbsp;
                                                        <a (click)="xemMauHoaDonTaiDay(item)"><i>(Xem tại đây)</i></a>
                                                    </ng-template>
                                                </div>
                                                <div>
                                                    - Mã thông điệp gửi CQT: <a
                                                        (click)="xemToKhai(item)">{{item.maThongDiepGui}}</a>
                                                </div>
                                                <div>
                                                    - Thời điểm chấp nhận: {{item.thoiDiemChapNhan | date:'dd/MM/yyyy
                                                    HH:mm:ss'}}
                                                </div>
                                            </nz-timeline-item>
                                            <nz-timeline-item *ngIf="item.trangThaiSuDung === 4" nzColor="gray">
                                                <div class="status-nhat-ky status-het-hieu-luc">
                                                    {{item.tenTrangThaiSuDung}}</div>
                                                <div *ngIf="item.loaiHetHieuLuc === 0">
                                                    - Bộ ký hiệu hết hiệu lực: tại thời điểm {{item.thoiGianXacThuc |
                                                    date:'dd/MM/yyyy HH:mm:ss'}}
                                                </div>
                                                <div *ngIf="item.loaiHetHieuLuc === 1">
                                                    - Bộ ký hiệu hết hiệu lực: tại thời điểm lập hóa đơn số
                                                    {{item.soLuongHoaDon}} ngày {{item.ngayHoaDon | date:'dd/MM/yyyy'}}
                                                </div>
                                                <div *ngIf="item.loaiHetHieuLuc === 2">
                                                    - Bộ ký hiệu hết hiệu lực: tại thời điểm hết thời hạn ủy nhiệm
                                                    {{item.thoiGianXacThuc | date:'dd/MM/yyyy HH:mm:ss'}}, số hóa đơn
                                                    lớn nhất đã lập là {{item.soLuongHoaDon}} ngày dd/mm/yyyy
                                                </div>
                                            </nz-timeline-item>
                                        </ng-container>
                                    </nz-timeline>
                                </div>
                            </div>
                        </div>
                    </div>
                </nz-card>
            </div>
        </form>
    </div>
</nz-spin>

<div *nzModalFooter>
    <button *ngIf="!btnXacThucHide"
        [disabled]="(isAddNew == false && permission != true && thaoTacs.indexOf('MNG_FULL') < 0 && thaoTacs.indexOf('MNG_UPDATE') < 0) || btnXacThucDisabled "
        [class.ant-btn-cus]="(isAddNew == false && permission != true && thaoTacs.indexOf('MNG_FULL') < 0 && thaoTacs.indexOf('MNG_UPDATE') < 0) || btnXacThucDisabled && mainForm.get('trangThaiSuDung').value === 4 && xacThucHetHieuLucCompleted"
        [ngClass]="{
            'disabled-button-state-v2': (isAddNew == false && permission != true && thaoTacs.indexOf('MNG_FULL') < 0 && thaoTacs.indexOf('MNG_UPDATE') < 0) || btnXacThucDisabled,
            'button-xacthuc':(mainForm.get('trangThaiSuDung').value === 0 || mainForm.get('trangThaiSuDung').value === 3 || (mainForm.get('trangThaiSuDung').value === 4 && !btnXacThucDisabled)),
            'button-ngungsudung':((mainForm.get('trangThaiSuDung').value === 1 || mainForm.get('trangThaiSuDung').value === 2) && !(isAddNew == false && permission != true && thaoTacs.indexOf('MNG_FULL') < 0 && thaoTacs.indexOf('MNG_UPDATE') < 0)) }"
        nzSize="small" nz-button nzType="default" (click)="onCLickXacThucSuDung()" [nzLoading]="spinning">
        <span
            *ngIf="mainForm.get('trangThaiSuDung').value === 0 || mainForm.get('trangThaiSuDung').value === 3 || mainForm.get('trangThaiSuDung').value === 4" >
            <i nz-icon nzType="check" nzTheme="outline"></i> Xác thực sử dụng
        </span>
        <span *ngIf="mainForm.get('trangThaiSuDung').value === 1 || mainForm.get('trangThaiSuDung').value === 2">
            <i nz-icon nzType="pause" nzTheme="outline"></i> Ngừng sử dụng
        </span>
    </button>
    <button *ngIf="!btnSuaHide"
        [disabled]="(isAddNew == false && permission != true && thaoTacs.indexOf('MNG_FULL') < 0 && thaoTacs.indexOf('MNG_UPDATE') < 0) || btnSuaDisabled "
        [class.button-clear]="!(isAddNew == false && permission != true && thaoTacs.indexOf('MNG_FULL') < 0 && thaoTacs.indexOf('MNG_UPDATE') < 0) && !btnSuaDisabled"
        [class.ant-btn-cus]="(isAddNew == false && permission != true && thaoTacs.indexOf('MNG_FULL') < 0 && thaoTacs.indexOf('MNG_UPDATE') < 0) || btnSuaDisabled"
        [ngClass]="{'disabled-button-state-v2': (isAddNew == false && permission != true && thaoTacs.indexOf('MNG_FULL') < 0 && thaoTacs.indexOf('MNG_UPDATE') < 0) || btnSuaDisabled}"
        nzSize="small" nz-button nzType="default" (click)="onClickSua()" class="blueButton" [nzLoading]="spinning">
        <i nz-icon nzSize="small" nzType="edit" nzTheme="outline"></i> Sửa
    </button>
    <button *ngIf="!btnLuuHide"
        [disabled]="(isAddNew == false && permission != true  && thaoTacs.indexOf('MNG_FULL') < 0) || btnLuuDisabled"
        nzSize="small"
        [class.button-clear]="!(isAddNew == false && permission != true  && thaoTacs.indexOf('MNG_FULL') < 0) && !btnLuuDisabled"
        [class.ant-btn-cus]="(isAddNew == false && permission != true  && thaoTacs.indexOf('MNG_FULL') < 0) || btnLuuDisabled"
        [ngClass]="{
    'disabled-button-state-v2': (isAddNew == false && permission != true  && thaoTacs.indexOf('MNG_FULL') < 0) || btnLuuDisabled,
    'footer-save': !(isAddNew == false && permission != true  && thaoTacs.indexOf('MNG_FULL') < 0) && !btnLuuDisabled
  }" nz-button nzType="default" (click)="submitForm()" [nzLoading]="spinning"><i nz-icon nzSize="small" nzType="save"
            nzTheme="outline"></i> Lưu
    </button>
    <button [disabled]="btnDongDisabled" [class.button-clear]="!btnDongDisabled" [class.ant-btn-cus]="btnDongDisabled"
        [ngClass]="{'disabled-button-state-v2': btnDongDisabled}" nzSize="small" nz-button nzType="default"
        (click)="closeModal()" class="button-cancel" [nzLoading]="spinning">
        <i nz-icon nzType="close"></i> Đóng
    </button>
</div>