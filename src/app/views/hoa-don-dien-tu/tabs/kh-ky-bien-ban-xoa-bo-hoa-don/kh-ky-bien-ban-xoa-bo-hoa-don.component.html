<nz-spin [nzSpinning]="spinning">
    <div style="height: 100%;background-color: #525659;">
        <form nz-form [formGroup]="mainForm" *ngIf="mainForm">
            <div nz-row style="background-color:white;">
                <div style="margin: 0px 20px 0px 20px;">
                    <img src="../../../../../assets/logo.png" style="display: inline-block; height: 45px; width: 191px;" />
                </div>
            </div>
            <div style="position: relative; overflow-y: auto;margin: 0px 120px 0px 120px;">
                <div *ngIf="fdata != null" nz-row style="height: 24px;padding-top: 5px;">
                    <div nz-col nzSpan="12" class="text-left">
                        <button style="float: left" (click)="download()" nz-button nzSize="small" class="blueButton">
                        <i nz-icon nzType="download" nzTheme="outline"></i>&nbsp;Tải biên bản (PDF)
                      </button>
                        <button style="float: left; margin-left: 4px;" (click)="taiBoCai()" nz-button nzSize="small" class="button-agree">
                        <i nz-icon nzType="download" nzTheme="outline"></i>&nbsp;Tải BKSOFT-KYSO
                      </button>
                    </div>
                    <div nz-col nzSpan="12">
                        <button style="float: right" (click)="xemCTS(1)" nz-button nzSize="small" class="yellowButton">
                        <i nz-icon nzType="eye" nzTheme="outline"></i>&nbsp;Xem chứng thư số người bán
                      </button>
                        <button style="float: right; margin-right: 4px;" (click)="traCuuThongTinNguoiBan()" nz-button nzSize="small" class="yellowButton">
                        <i nz-icon nzType="search" nzTheme="outline"></i>&nbsp;Tra cứu thông tin người bán
                      </button>
                    </div>
                </div>
                <div *ngIf="fdata != null" nz-row style="height: 640px;margin-top: 10px; background-color: white; overflow-y: auto; width: 100%;padding: 10px 60px;">
                    <h1 style="text-align: center;text-transform: uppercase;"><strong>Cộng hòa xã hội chủ nghĩa Việt Nam</strong></h1>
                    <h2 style="text-align: center;"><strong>Độc lập - Tự do - Hạnh phúc</strong></h2>
                    <hr style="width: 14%;background-color: black;margin: 0 auto;color: black;">
                    <h3 style="text-align: center;text-transform: uppercase;font-size: 15px !important;margin: 20px;font-weight: bold;">BIÊN BẢN HỦY HÓA ĐƠN</h3>

                    <nz-form-item>
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="soBienBan">Số biên bản</nz-form-label>
                        <nz-form-control [nzSm]="8" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="soBienBan" />
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <textarea rows="7" nz-input formControlName="thongTu"></textarea>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="ngayBienBan">Hôm nay, vào ngày</nz-form-label>
                        <nz-form-control [nzSm]="4" [nzXs]="24">
                            <input style="width: 150px;" nz-input nzSize="small" type="date" formControlName="ngayBienBan" />
                        </nz-form-control>
                        <span>, chúng tôi gồm có:</span>
                    </nz-form-item>
                    <nz-form-item style="text-transform: uppercase; font-weight: bold;">
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="tenCongTyBenA">Bên A</nz-form-label>
                        <nz-form-control [nzSm]="20" [nzXs]="24">
                            <input style="text-transform: uppercase;font-weight: bold;" nz-input nzSize="small" type="text" formControlName="tenCongTyBenA" />
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="diaChiBenA">Địa chỉ</nz-form-label>
                        <nz-form-control [nzSm]="20" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="diaChiBenA" />
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="maSoThueBenA">Mã số thuế</nz-form-label>
                        <nz-form-control [nzSm]="8" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="maSoThueBenA" />
                        </nz-form-control>
                        <nz-form-label [nzSm]="4" [nzXs]="24" class="pd-left-15" nzFor="soDienThoaiBenA">Số điện thoại</nz-form-label>
                        <nz-form-control [nzSm]="8" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="soDienThoaiBenA" />
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="daiDienBenA">Đại diện</nz-form-label>
                        <nz-form-control [nzSm]="8" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="daiDienBenA" />
                        </nz-form-control>
                        <nz-form-label [nzSm]="4" [nzXs]="24" class="pd-left-15" nzFor="chucVuBenA">Chức vụ</nz-form-label>
                        <nz-form-control [nzSm]="8" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="chucVuBenA" />
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item style="text-transform: uppercase; font-weight: bold;">
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="tenKhachHang">Bên B</nz-form-label>
                        <nz-form-control [nzSm]="20" [nzXs]="24">
                            <input style="text-transform: uppercase;font-weight: bold;" nz-input nzSize="small" type="text" formControlName="tenKhachHang" />
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="diaChi">Địa chỉ</nz-form-label>
                        <nz-form-control [nzSm]="20" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="diaChi" />
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="maSoThue">Mã số thuế</nz-form-label>
                        <nz-form-control [nzSm]="8" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="maSoThue" />
                        </nz-form-control>
                        <nz-form-label [nzSm]="4" [nzXs]="24" class="pd-left-15" nzFor="soDienThoai">Số điện thoại</nz-form-label>
                        <nz-form-control [nzSm]="8" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="soDienThoai" />
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="daiDien">Đại diện</nz-form-label>
                        <nz-form-control [nzSm]="8" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="daiDien" />
                        </nz-form-control>
                        <nz-form-label [nzSm]="4" [nzXs]="24" class="pd-left-15" nzFor="chucVu">Chức vụ</nz-form-label>
                        <nz-form-control [nzSm]="8" [nzXs]="24">
                            <input nz-input nzSize="small" type="text" formControlName="chucVu" />
                        </nz-form-control>
                    </nz-form-item>
                    Hai bên thống nhất lập biên bản này để thu hồi và xóa bỏ hóa đơn có mẫu số <strong>{{fdata?.mauSo}}</strong> ký hiệu <strong>{{fdata?.kyHieu}}</strong> số <strong>{{fdata?.soHoaDon}}</strong> ngày <strong>{{fdata?.ngayHoaDon | date: 'dd/MM/yyyy'}}</strong>&nbsp;
                    mã tra cứu <strong>{{fdata?.maTraCuu}}</strong> theo quy định
                    <nz-form-item>
                        <nz-form-label [nzSm]="4" [nzXs]="24" nzFor="lyDoXoaBo">Lý do hủy hóa đơn</nz-form-label>
                        <nz-form-control [nzSm]="20" [nzXs]="24" [nzErrorTip]="errorLD">
                            <textarea rows="4" nz-input formControlName="lyDoXoaBo" tooltipInput></textarea>
                            <ng-template #errorLD let-control>
                                <ng-container *ngIf="control.hasError('required')">
                                    <div class="tooltip-error">&lt;Lý do hủy hóa đơn&gt; không được để trống.</div>
                                </ng-container>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                    <p>Chúng tôi xin cam kết các thông tin khai ở trên là hoàn toàn chính xác. Nếu có bất kỳ sai sót nào chúng tôi xin chịu trách nhiệm trước pháp luật.</p>
                    <br>
                    <div nz-row>
                        <div nz-col nzSpan="12">
                            <h3 style="text-align: center;"><strong>Đại diện bên A</strong></h3>
                            <h4 style="text-align: center;">(Chữ ký số, chữ ký điện tử)</h4>
                            <app-chu-ky-dien-tu (click)="xemCTS(1)" *ngIf="formData && formData.ngayKyBenA != null" [tenDonVi]="formData.tenCongTyBenA" [ngayKy]="formData.ngayKyBenA | date:'dd/MM/yyyy HH:mm:ss'"></app-chu-ky-dien-tu>

                            <!-- <div class="sign-box" *ngIf="formData && formData.ngayKyBenA != null">
                                <div>Signature Valid</div>
                                <div>Ký bởi: <span>{{formData.tenCongTyBenA}}</span></div>
                                <div>Ngày ký: <span>{{formData.ngayKyBenA | date:'dd/MM/yyyy'}}</span></div>
                            </div> -->
                        </div>
                        <div nz-col nzSpan="12" style="text-align: center;">
                            <h3 style="text-align: center;"><strong>Đại diện bên B</strong></h3>
                            <h4 style="text-align: center;">(Chữ ký số, chữ ký điện tử)</h4>
                            <app-chu-ky-dien-tu (click)="xemCTS(2)" *ngIf="formData && formData.ngayKyBenB != null" [tenDonVi]="formData.tenKhachHang" [ngayKy]="formData.ngayKyBenB | date:'dd/MM/yyyy HH:mm:ss' "></app-chu-ky-dien-tu>

                            <!-- <div class="sign-box" *ngIf="formData && formData.ngayKyBenB != null">
                                <div>Signature Valid</div>
                                <div>Ký bởi: <span>{{formData.tenKhachHang}}</span></div>
                                <div>Ngày ký: <span>{{formData.ngayKyBenB | date:'dd/MM/yyyy'}}</span></div>
                            </div> -->
                            <h3 *ngIf="formData && formData.ngayKyBenB == null" style="text-align: center;"><button class="blueButton" nz-button nzSize="small" nzType="default" (click)="kyDienTu()"><i nz-icon nzSize="small" nzType="safety-certificate"></i>Ký điện tử</button></h3>
                        </div>
                    </div>
                    <!-- <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-top:15px;">
                      <div nz-col class="gutter-row" [nzSpan]="24">
                          <nz-form-item nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }">
                              <nz-form-label nz-col class="gutter-row" [nzSpan]="4" nzFor="" title="" nzFor="taiLieuDinhKem">Đính kèm
                              </nz-form-label>
                              <nz-form-control nz-col class="gutter-row" [nzSpan]="3" nzErrorTip="Vui lòng chọn tài liệu đính kèm!">
                                  <button nz-button (click)="fImport.click()" class="blueButton" nzSize="small">
                                  <i nz-icon nzType="paper-clip" nzTheme="outline"></i>
                              Đính kèm...
                            </button>
                                  <input id="fImport" type="file" #fImport (change)="uploadFile($event)" style="display: none;" multiple>
                              </nz-form-control>
                              <div nz-col class="gutter-row" [nzSpan]="14">
                                  <div class="file-list">
                                      <div class="file-item" *ngFor="let item of listFile">
                                          <a (click)="downloadFile(item)">{{item.tenGoc}}</a> &nbsp;&nbsp; <i style="color: red;cursor: pointer;" (click)="deleteFile(item)" nz-icon nzType="close" nzTheme="outline"></i>
                                      </div>
                                  </div>
                              </div>
                          </nz-form-item>
                      </div>
                  </div> -->
                </div>
                <div *ngIf="fdata == null" style="width: 450px; transform-origin: 275px 128px 0px; margin: 100px auto;">
                    <div class="ant-modal-content" style="box-shadow: 5px 7px 12px rgb(0 0 0 / 40%);border-radius: 4px !important;">
                        <div class="ant-modal-body ng-star-inserted" style="padding: 1px;">
                            <div style="padding: 15px">
                                <div class="LuuY ng-star-inserted" style="font-size:18px !important;margin-bottom: 10px!important; color: #0070C0!important"> <i nz-icon nzType="info-circle" nzTheme="outline" class="customIcon"></i> Xóa biên bản hủy hóa đơn</div>
                                <div class="ng-star-inserted" style="font-size: 16px !important;">Người bán đã xóa biên bản hủy hóa đơn khỏi hệ thống. Vui lòng liên hệ với người bán nếu bạn chưa được người bán thông báo về việc xóa này.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</nz-spin>
