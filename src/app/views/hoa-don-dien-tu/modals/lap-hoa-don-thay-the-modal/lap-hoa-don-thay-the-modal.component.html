<nz-spin [nzSpinning]="spinning">
    <div style="height: 100%; padding: 9px">
        <form nz-form [formGroup]="form">
            <div class="filter-list-container">
                <div class="ky-wrapper">
                    <div>Kỳ</div>
                    <nz-select style="width: 100%;" nzSize="small" nzShowSearch nzPlaceHolder="Chọn kỳ" formControlName="ky" (ngModelChange)="changeKy($event)">
                        <nz-option *ngFor="let item of kys" [nzLabel]="item.value" [nzValue]="item.key"></nz-option>
                    </nz-select>
                </div>
                <div class="ngay-wrapper">
                    <div>Từ ngày</div>
                    <input nzSize="small" max="2999-12-31" type="date" nz-input formControlName="fromDate" (blur)="blurDate()" />
                </div>
                <div class="ngay-wrapper">
                    <div>Đến ngày</div>
                    <input nzSize="small" max="2999-12-31" type="date" nz-input formControlName="toDate" (blur)="blurDate()" />
                </div>
                <div class="tim-kiem-theo-wrapper">
                    <div>Tìm kiếm theo</div>
                    <nz-form-item>
                        <nz-form-control [nzSm]="24" [nzXs]="24" [nzErrorTip]="errorTimKiemTheo">
                            <div nz-col nzSpan="24">
                                <nz-input-group [nzPrefix]="prefixTemplateUser" nzSize="small">
                                    <input type="text" formControlName="giaTri" nz-input [placeholder]="placeHolderTimKiemTheo()" nz-tooltip [nzTooltipTitle]="placeHolderTimKiemTheo() || null" nzTooltipPlacement="bottomRight" (ngModelChange)="changeGiaTri($event)" />
                                </nz-input-group>

                                <ng-template #errorTimKiemTheo let-control>
                                    <ng-container *ngIf="control.hasError('required')">
                                        <div class="tooltip-error">&lt;Tìm kiếm theo&gt; không được để trống.</div>
                                    </ng-container>
                                </ng-template>

                                <ng-template #prefixTemplateUser>
                                    <i nz-icon nzType="setting" nzTheme="outline" nz-dropdown [nzDropdownMenu]="menuPlusMutiple2" [nzClickHide]="false"></i>
                                    <nz-dropdown-menu #menuPlusMutiple2="nzDropdownMenu">
                                        <ul nz-menu>
                                            <li nz-menu-item *ngFor="let item of timKiemTheos">
                                                <!-- <label nz-checkbox [(ngModel)]="item.checked" [ngModelOptions]="{standalone: true}">{{item.name}}</label> -->
                                                <label *ngIf="item.hidden != true" ngClass='ckbcheckBox' nz-checkbox [(ngModel)]="item.checked" [nzValue]="item.key" (ngModelChange)="onchange_timKiemTheos($event)" [ngModelOptions]="{standalone: true}">{{item.value}}</label>
                                            </li>
                                        </ul>
                                    </nz-dropdown-menu>
                                </ng-template>
                            </div>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div class="lay-du-lieu-wrapper">
                    <div>&nbsp;</div>
                    <button nz-button nzSize="small" (click)="getData()" class="blueButton" style="padding: 0 10px !important;"><i nz-icon nzType="sync" nzTheme="outline"></i>Lấy dữ liệu</button>
                </div>
            </div>
        </form>
        <div nz-row>
            <nz-table [nzNoResult]="null" nzSize="small" #expandTable [nzData]="listData" [nzWidthConfig]="widthConfig" [nzScroll]="scrollConfig" [nzFrontPagination]="false" [nzTotal]="total" [nzPageIndex]="1" [nzPageSize]="total" nzBordered [nzHideOnSinglePage]="true">
                <thead>
                    <tr>
                        <th nzAlign="center" nzLeft="0px">Trạng thái hóa đơn</th>
                        <!-- <th nzAlign="center">Hình thức hóa đơn</th> -->
                        <!-- <th nzAlign="center">Ủy nhiệm lập hóa đơn</th> -->

                        <!-- <th nzAlign="center">Loại hóa đơn</th>
            <th nzAlign="center">Mã CQT cấp</th> -->

                        <th nzAlign="center">Ký hiệu mẫu số hóa đơn</th>
                        <th nzAlign="center">Ký hiệu hóa đơn</th>
                        <th nzAlign="center">Ngày hóa đơn</th>
                        <th nzAlign="center">Số hóa đơn</th>
                        <th nzAlign="center">Mã khách hàng</th>
                        <th nzAlign="center">Tên khách hàng</th>
                        <!-- <th nzAlign="center">Địa chỉ</th> -->
                        <th nzAlign="center">Mã số thuế</th>
                        <th nzAlign="center">Người mua hàng</th>
                        <th nzAlign="center">Loại tiền</th>
                        <th nzAlign="center">Tổng tiền thanh toán</th>
                    </tr>
                </thead>
                <tbody>
                    <ng-container *ngFor="let data of expandTable.data">
                        <tr (click)="selectedRow(data)" (dblclick)="submitForm()" [class.row-selected]="data.selected">
                            <!-- <td [class.row-selected]="data.selected"  nzLeft = "0px">
                <span *ngIf="data?.trangThai == 1">
                  <span class="lightBlueRoundedShape" title="Hóa đơn gốc">Hóa đơn gốc</span>&nbsp;<span style = "color: red">| Đã bị xóa bỏ</span>
                </span>

                <span *ngIf="data?.trangThai == 3">
                  <span class="hoaDonThayTheRoundedShape" title="Hóa đơn thay thế">Thay thế</span>&nbsp;<span style = "color: red">| Đã bị xóa bỏ</span>
                </span>

                <span *ngIf="data?.trangThai != 3 && data?.trangThai != 1">
                  <span class="oldOrangeRoundedShape" title = "{{data.tenTrangThaiHoaDon}}">Xóa bỏ</span>
                </span>
              </td> -->
                            <td [class.row-selected]="data.selected" nzLeft="0px">
                                <span *ngIf="data?.backUpTrangThai == 1 && (data?.hinhThucXoabo == 2 || data?.hinhThucXoabo == 5)">
                                  <span class="lightBlueRoundedShape" title="{{txtHD_PXK_UPPER}} gốc">{{txtHD_PXK_UPPER}} gốc</span>&nbsp;<span style="color: red">| Đã bị xóa bỏ</span>
                                </span>

                                <span *ngIf="data?.backUpTrangThai == 3 && (data?.hinhThucXoabo == 2 || data?.hinhThucXoabo == 5)">
                                  <span class="hoaDonThayTheRoundedShape" title="{{txtHD_PXK_UPPER}} thay thế">{{txtHD_PXK_UPPER}} thay thế</span>&nbsp;<span style="color: red">| Đã bị xóa bỏ</span>
                                </span>

                                <span *ngIf="data?.trangThai == 1 && data?.hinhThucXoabo == null">
                                  <span class="lightBlueRoundedShape" title="{{txtHD_PXK_UPPER}} gốc">{{txtHD_PXK_UPPER}} gốc</span>
                                </span>

                                <span *ngIf="data?.trangThai == 3 && data?.hinhThucXoabo == null">
                                  <span class="hoaDonThayTheRoundedShape" title="{{txtHD_PXK_UPPER}} thay thế">{{txtHD_PXK_UPPER}} thay thế</span>
                                </span>
                            </td>
                            <!-- <td [class.row-selected]="data.selected">
                <span *ngIf = "data.kyHieu.indexOf('C') == 0">Có mã của cơ quan thuế</span>
                <span *ngIf = "data.kyHieu.indexOf('K') == 0">Không có mã của cơ quan thuế</span>
              </td> -->

                            <!-- <td [class.row-selected]="data.selected">
                                {{data.tenUyNhiemLapHoaDon}}
                            </td> -->

                            <!-- <td [class.row-selected]="data.selected">{{data.tenLoaiHoaDon}}</td>
              <td [class.row-selected]="data.selected" [ngClass] = "{'grayCell': !data.selected && data.kyHieu.indexOf('K') == 0}">
                <span *ngIf = "data.kyHieu.indexOf('C') == 0" title = "{{data.maCuaCQT}}">
                  {{data.maCuaCQT == ''? '&lt;Chưa cấp mã&gt;':data.maCuaCQT}}
                </span>
                <span *ngIf = "data.kyHieu.indexOf('K') == 0"></span>
              </td> -->

                            <td [class.row-selected]="data.selected">{{data.mauSo}}</td>
                            <td [class.row-selected]="data.selected">{{data.kyHieu}}</td>
                            <td [class.row-selected]="data.selected" nzAlign="center">{{data.ngayHoaDon | date:'dd/MM/yyyy'}}</td>
                            <td [class.row-selected]="data.selected">{{data.soHoaDon}}</td>
                            <td [class.row-selected]="data.selected">{{data.maKhachHang}}</td>
                            <td [class.row-selected]="data.selected" title="{{data.tenKhachHang}}">{{data.tenKhachHang}}</td>
                            <!-- <td [class.row-selected]="data.selected">{{data.diaChi}}}</td> -->
                            <td [class.row-selected]="data.selected">{{data.maSoThue}}</td>
                            <td [class.row-selected]="data.selected">{{data.hoTenNguoiMuaHang}}</td>
                            <td [class.row-selected]="data.selected">{{data.maLoaiTien}}</td>
                            <td [class.row-selected]="data.selected" class="money">{{data.tongTienThanhToanQuyDoi | formatPrice}}
                            </td>
                        </tr>
                    </ng-container>
                    <tr class="total-footer" *ngIf="total == 0">
                        <td colspan="11">Không có dữ liệu hiển thị.</td>
                    </tr>
                </tbody>
                <tfoot *ngIf="total > 0" class="total-footer">
                    <td colspan="1" nzLeft="0px">Số dòng = {{total}}</td>
                    <td colspan="10"></td>
                </tfoot>
            </nz-table>


        </div>
    </div>

    <div *nzModalFooter style="padding: 0px 3px;">
        <button *ngIf="!isChuyenHoaDonGocThanhThayThe" nz-button nz-dropdown [nzDropdownMenu]="menuThayTheKhac" nzSize="small" class="blueButton" style="float: left">
    <i nz-icon nzSize="small" nzType="select"></i>Thay thế khác<i nz-icon nzType="down"></i></button>
        <nz-dropdown-menu #menuThayTheKhac="nzDropdownMenu">
            <ul nz-menu>
                <li nz-menu-item (click)="thayTheHinhThucHoaDonKhac(2)" nz-tooltip nzTooltipTitle='Khai báo thông tin hóa đơn có loại áp dụng hóa đơn khác loại “Hóa đơn điện tử theo Nghị định 123/2020/NĐ-CP” cần lập hóa đơn thay thế' nzTooltipPlacement="rightTop">
                    Loại áp dụng hóa đơn khác
                </li>
                <li nz-menu-item (click)="thayTheHinhThucHoaDonKhac(1)" nz-tooltip nzTooltipTitle='Khai báo thông tin hóa đơn có loại áp dụng hóa đơn là “Hóa đơn điện tử theo Nghị định 123/2020/NĐ-CP” được lập từ phần mềm giải pháp khác cần lập hóa đơn thay thế' nzTooltipPlacement="rightTop">
                    Hóa đơn lập trên PMGP khác
                </li>
            </ul>
        </nz-dropdown-menu>

        <div *ngIf="!isChuyenHoaDonGocThanhThayThe" style="display: inline-block">
            <label nz-checkbox [(ngModel)]="tichChonNhanBanThongTin" style="color: #1877F2!important">Nhân bản thông tin hóa đơn xóa bỏ để lập hóa đơn thay thế</label>
        </div>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <button nz-button nzType="default" (click)="submitForm()" class="blueButton" nzSize="small"><i nz-icon nzType="check" nzTheme="outline"></i>Đồng ý</button>
        <button nz-button nzType="default" (click)="closeModal()" class="button-cancel" nzSize="small"><i nz-icon nzSize="small" nzType="close"></i>Hủy</button>
    </div>
</nz-spin>