<nz-spin [nzSpinning]="spinning">
  <nz-tabset class="tab-set" [nzTabPosition]="'left'" [(nzSelectedIndex)]="selectedIndex">
    <nz-tab nzTitle="Chọn hóa đơn tải xuống" [nzDisabled]="true">
      <div nz-row style="margin-left: 8px !important;">
        <div class="inner-content">
          <div nz-row class="inner-content">
            <div class="box-border" style="margin: 5px;">
              <span class="box-title">Tham số</span>
              <div nz-row style="margin-bottom: 10px;">
                <div nz-col nzSpan="11" style="margin-right: 5px;">
                  <div>Khách hàng</div>
                  <nz-select style="width:100%" nzPlaceHolder="Chọn khách hàng" nzSize="small" nzShowSearch nzAllowClear
                    (ngModel)="displayData.khachHangId" nzServerSearch
                    (nzOnSearch)="searchDoiTuong($event)"
                    (nzScrollToBottom)="loadMoreDoiTuong()" (nzOpenChange)="openChangeDropDown($event)"
                    [nzDropdownStyle]="searchCustomerOverlayStyle1"
                    (nzFocus)="focusComboBox('khachhang', 'khachHangId', '')">
                    <ng-container>
                      <nz-option *ngIf="!loadingSearchDropdown" nzCustomContent nzDisabled="true">
                        <div nz-row>
                          <div nz-col nzXs="8" nzSm="8" nzMd="8" nzLg="8" nzXl="8">
                            Mã khách hàng
                          </div>
                          <div nz-col nzXs="16" nzSm="16" nzMd="16" nzLg="16" nzXl="16">
                            Tên khách hàng
                          </div>
                        </div>
                      </nz-option>
                      <nz-option *ngFor="let item of doiTuongs" nzCustomContent [nzLabel]="item?.ma"
                        [nzValue]="item?.doiTuongId">
                        <!-- {{item.ma}} - {{item.ten}} -->
                        <div nz-row>
                          <div title="{{item?.ma}}" nz-col nzXs="8" nzSm="8" nzMd="8" nzLg="8" nzXl="8">
                            <div class="text-ellipsis">{{item?.ma}}</div>
                          </div>
                          <div title="{{item?.ten}}" nz-col nzXs="16" nzSm="16" nzMd="16" nzLg="16" nzXl="16">
                            <div class="text-ellipsis">{{item?.ten}}</div>
                          </div>
                        </div>
                      </nz-option>
                    </ng-container>
                    <nz-option *ngIf="loadingSearchDropdown" nzDisabled nzCustomContent>
                      <i nz-icon nzType="loading" class="loading-icon"></i> Đang tải...
                    </nz-option>
                    <nz-option *ngIf="isLoadingMore" nzDisabled nzCustomContent>
                      <i nz-icon nzType="loading" class="loading-icon"></i> Đang tải thêm...
                    </nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="11"  style="margin-right: 5px;">
                  <div>Loại hóa đơn</div>
                  <nz-select style="width: 100%;" nzSize="small" nzShowSearch [(ngModel)]="displayData.LoaiHoaDon"
                    title="Loại hóa đơn">
                    <nz-option nzLabel="Hóa đơn giá trị gia tăng" [nzValue]="1"></nz-option>
                    <nz-option nzLabel="Hóa đơn bán hàng" [nzValue]="2"></nz-option>
                    <nz-option nzLabel="Tất cả" [nzValue]="-1"></nz-option>
                  </nz-select>
                </div>
              </div>
              <div nz-row style="margin-bottom: 10px;">
                <div nz-col nzSpan="11"  style="margin-right: 5px;">
                  <div>Kỳ</div>
                  <nz-select style="width: 100%;" nzSize="small" nzShowSearch nzPlaceHolder="Chọn kỳ"
                    [(ngModel)]="displayData.Ky" (ngModelChange)="changeKy($event)">
                    <nz-option *ngFor="let item of kys" [nzLabel]="item.value" [nzValue]="item.key"></nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="4"  style="margin-right: 5px;">
                  <div>Từ ngày</div>
                  <input style="width: 100%;" nzSize="small" type="date" max="2999-12-31" nz-input
                    [(ngModel)]="displayData.fromDate" placeholder="Từ" (keydown.enter)="filterTable()"
                    (keydown.enter)="filterVisible= false" (blur)="blurDate()" />
                </div>
                <div nz-col nzSpan="4"  style="margin-right: 5px;">
                  <div>Đến ngày</div>
                  <input style="width: 100%;" nzSize="small" type="date" max="2999-12-31" nz-input
                    [(ngModel)]="displayData.toDate" placeholder="Đến" (keydown.enter)="filterTable()"
                    (keydown.enter)="filterVisible= false" (blur)="blurDate()" />
                </div>
                <div nz-col nzSpan="3"  style="margin-right: 5px;">
                  <div style="color: white">Lấy dữ liệu</div>
                  <button style="width:100%" nzSize="small" nzBlock nz-button nzType="default" (click)="getData()"
                  class="button-default">
                  Lấy dữ liệu
                </button>
                </div>
              </div>
            </div>
          </div> 
        </div>
        <nz-table [nzNoResult]="null" style="margin-top: 5px;" nzSize="small" #fixedTablePH [nzData]="listOfPhatHanh" [nzWidthConfig]="widthConfigB"
        [nzScroll]="scrollConfigB" [nzShowPagination]="false" [nzFrontPagination]="false"
        [nzTotal]="totalPH" [nzPageIndex]="1" [(nzPageSize)]="totalPH" nzBordered [nzLoading]="loading">
          <thead>
              <tr>
                <th nzLeft="0px" nzShowCheckbox [(nzChecked)]="isAllPhatHanhChecked" [nzIndeterminate]="isPHIndeterminate"
                  (nzCheckedChange)="checkAllPH($event)">
                </th>
                <th nzAlign="center">Loại hóa đơn</th>
                <th nzAlign="center">Mẫu số hóa đơn</th>
                <th nzAlign="center">Ký hiệu hóa đơn</th>
                <th nzAlign="center">Ngày hóa đơn</th>
                <th nzAlign="center">Số hóa đơn</th>
                <th nzAlign="center">Mã khách hàng</th>
                <th nzAlign="center">Tên khách hàng</th>
                <th nzAlign="center">Địa chỉ</th>
                <th nzAlign="center">Mã số thuế</th>
                <th nzAlign="center">Người mua hàng</th>
                <th nzAlign="center">Loại tiền</th>
                <th nzAlign="center">Tổng tiền thanh toán</th>
              </tr>
          </thead>
          <tbody>
                <tr *ngFor="let data of fixedTablePH.data; let i=index" (click)="selectedRow(data)">
                  <td nzLeft="0px" nzShowCheckbox [class.row-selected]="data.selected"
                    [(nzChecked)]="mapOfCheckedIdPH[data.hoaDonDienTuId]" (nzCheckedChange)="refreshStatusPH()">
                  </td>
                  <td [class.row-selected]="data.selected">
                    <span *ngIf="data?.trangThai == 1">Hóa đơn gốc</span>
                    <span *ngIf="data?.trangThai == 2">Hóa đơn xóa bỏ</span>
                    <span *ngIf="data?.trangThai == 3">Hóa đơn thay thế</span>
                    <span *ngIf="data?.trangThai == 5">Hóa đơn điều chỉnh tăng</span>
                    <span *ngIf="data?.trangThai == 6">Hóa đơn điều chỉnh giảm</span>
                    <span *ngIf="data?.trangThai == 7">Hóa đơn điều chỉnh thông tin</span>
                  </td>
                  <td [class.row-selected]="data.selected">{{ data?.mauSo}}
                  </td>
                  <td [class.row-selected]="data.selected">{{ data?.kyHieu}}
                  </td>
                  <td [class.row-selected]="data.selected">{{ data?.ngayHoaDon | date: 'dd/MM/yyyy' }}</td>
                  <td [class.row-selected]="data.selected"><a (click)="xemHoaDon(data)">{{ data?.soHoaDon }}</a></td>
                  <td [class.row-selected]="data.selected">{{ data?.maKhachHang }}</td>
                  <td [class.row-selected]="data.selected">{{ data?.tenKhachHang }}</td>
                  <td [class.row-selected]="data.selected">{{ data?.diaChi }}</td>
                  <td [class.row-selected]="data.selected">{{ data?.maSoThue }}</td>
                  <td [class.row-selected]="data.selected">{{ data?.hoTenNguoiMuaHang }}</td>
                  <td [class.row-selected]="data.selected">{{ data?.loaiTien.ma }}</td>
                  <td class="money" [class.row-selected]="data.selected">{{ data?.tongTienThanhToan | formatPrice:true:ddtp.getTienQuyDoi() }}</td>
              </tr>
              <tr *ngFor="let obj of lstBangKeBEmpty">
                <td *ngFor="let empty of numberBangKeBCols; let idx = index">
                    <span *ngIf="idx===0" class="font-while">.</span>
                </td>
              </tr>
              <tr class="total-footer" *ngIf="listOfPhatHanh.length > 0">
                <td nzLeft="0px">
                </td>
                <td colspan="2">Số dòng = {{listOfPhatHanh.length}}</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{ listOfPhatHanh | sum: 'tongTienThanhToan' | formatPrice:true:ddtp.getTienQuyDoi() }}</td>
              </tr>
          </tbody>
        </nz-table>
        <div nz-row>
          <div style="float: left; margin: 5px 0px;" nz-col nzSpan="12">
            <button nz-button nzType="default" style="margin-left: 2px;" (click)="view()"><i nz-icon nzSize="small" nzType="eye" nzTheme="outline"></i>Xem hóa đơn đồng loạt</button>
          </div>
          <div style="float: right; margin: 5px 0px;" nz-col nzSpan="12">
            <button nz-button nzType="default" style="float: right;margin-right: 2px;" (click)="cancel()" class="button-cancel"><i nz-icon nzSize="small" nzType="close"></i>Hủy</button>
            <button nz-button nzType="default" style="float: right;margin-right: 2px;" (click)="download()" class="button-agree"><i nz-icon nzSize="small" nzType="download" nzTheme="outline"></i>Tải hóa đơn</button>
          </div>
        </div>
      </div>
    </nz-tab>
  </nz-tabset>
</nz-spin>

